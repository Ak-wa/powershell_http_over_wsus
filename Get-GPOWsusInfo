function Get-GPOWsusInfo {
    $GPO = Get-GPO -All
    foreach ($Policy in $GPO) {
        $GPOID = $Policy.Id
        $GPODisp = $Policy.DisplayName
        [xml]$xml = Get-GPOReport -Id $GPOID -ReportType xml -ErrorAction SilentlyContinue
        $WSUSBase = Get-GPRegistryValue -Guid $GPOID -Key 'HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate' -ErrorAction SilentlyContinue
        $WSUSServer = if ($WSUSBase) { ($WSUSBase | Where-Object { $_.ValueName -eq 'WUServer' }).Value }
        
        [PSCustomObject]@{
            GPOName = $GPODisp
            WSUSServer = $WSUSServer
        }
    }
}

Get-GPOWsusInfo
